// var imagePath = '../../../../../../Users/gabrielbach/Desktop/Salemoche/Freelance/Possa/InDesign_Scripting/Test/Test_Daten/Probesatz/Bilder/180319/'

var data = 
[
    {
        "Profil_": "SP",
        "Position_": "1",
        "Datum_": "3/18/2019",
        "Uhrzeit_": "13:45",
        "Thema_": "Kantonsrat",
        "Gesinnung_": "Links",
        "Verl�sslichkeit_": "Reisserisch",
        "Art_": "Partei",
        "Aufbau_": "Post-Artikel",
        "Medium_": "Text-Bild",
        "Bodytext_": "*pn*Gr�ne Z�rich*/pn*\n\n*pd*18.03.19*/pd*\n\n*pb*�Vor ihm haben unsere Eltern uns immer gewarnt�, schreibt der�Tages-Anzeiger��ber unseren Kantonsrat R�bi Brunner!�Rafa Ella Roth�vom startet ihren neuen Tagi-Videotalk �Hobbyruum�.�#Klimawahl2019*/pb*\n\n*ab*Tagesanzeiger*/ab*\n\n*ad*15.03.19*/ad*\n\n*an*someName*/an*\n\n*aa*Rafaela Roth*/aa*\n\n*at*Vor ihm haben unsere Eltern uns immer gewarnt*/at*\n\n*al*Rafaela Roth trifft auf den Charmebolzen der Gr�nen: Robert �R�bi� Brunner. Start des Tagi-Videotalks �Hobbyruum�.*/al*\n\n*ab*Am 24. M�rz w�hlt der Kanton Z�rich eine neue Regierung. Bis dahin schnappt sich die Z�ri-Redaktorin Rafaela Roth ein paar potenzielle Kandidierende f�r eine kleine Bastel-Challenge. Dies ist der neue �Hobbyruum�, ein Videotalk, in welchem wir nicht nur �ber Politik sprechen, aber auch. Sehen Sie jetzt Folge 1 - heute mit dem Kantonsrat der Gr�nen: Robert �R�bi� Brunner.*/ab**ab*jlaksdjföl kajsdöfoija weöoifjaoöwiejföaijseflöi ajsdflö*/ab*",
        "LinkText_": "https://www.tagesanzeiger.ch/zuerich/region/vor-ihm-haben-unsere-eltern-uns-immer-gewarnt/story/29250246?fbclid=%20a-W0xm7rwdCcTAy96QSjQgLH5-QDSB0",
        "LinkBild_": "DS_A_26-03-19",
        "Bildunterschriften_": "Robert Brunners Lieblingsdroge?: �Rotwein! Drogen machen eine weiche Birne.�.Video: Lea Blum, Sarah Fluck"
    },
    {
        "Profil_": "DD",
        "Position_": "2",
        "Datum_": "3/18/2019",
        "Uhrzeit_": "16:04",
        "Thema_": "Demonstration",
        "Gesinnung_": "Rechts",
        "Verl�sslichkeit_": "Reisserisch",
        "Art_": "Privat Person",
        "Aufbau_": "Re-Post-Artikel",
        "Medium_": "Text-Bild",
        "Bodytext_": "*pn*Erich Hess*/pn*\n\n*pd*18.03.2019*/pd*\n\n*pb*Das ist typisch f�r den rot - gr�nen Filz in der Stadt Bern!*/pb*\n\n*rn*TeleB�rn*/rn*\n\n*aa*TeleB�rn*/aa*\n\n*rd*18.03.2019*/rd*\n\n*rt*Klima-Aktivisten d�rfen trotz Kundgebungs-Verbot demonstrieren:*/rt*\n\n*an*TeleB�rn News*/an*\n\n*ad*17.03.2019*/ad*\n\n*at*�Eine absolute Sauerei!� Erich Hess �rgert sich �ber Kundgebungs-Erlaubnis der Klima-Aktivisten*/at*\n\n*ab* Grunds�tzlich gilt zwei Wochen vor den eidgen�ssischen Wahlen ein Kundgebungs-Verbot. Klimaschutz-Aktivisten planen jedoch kurz vorher erneut eine Demo � und das sogar mit Erlaubnis. */ab**al*Some Lead Some Lead Some Lead Some Lead Some Lea*/al*",
        "LinkText_": "https://www.telebaern.tv/telebaern-news/eine-absolute-sauerei-erich-hess-aergert-sich-ueber-kundgebungs-erlaubnis-der-klima-aktivisten-134221166?utm_source=shared-twitter&fbclid=IwAR2DMQycuNK_OiDkvaLpp2KcAg2gwONaauP0IR5cthGdnTE8k8lSELatxvU",
        "LinkBild_": "Bildschirmfoto 2019-03-18 um 15.05.09",
        "Bildunterschriften_": ""
    },
    {
        "Profil_": "SP",
        "Position_": "1",
        "Datum_": "3/18/2019",
        "Uhrzeit_": "13:45",
        "Thema_": "Kantonsrat",
        "Gesinnung_": "Links",
        "Verl�sslichkeit_": "Reisserisch",
        "Art_": "Partei",
        "Aufbau_": "Post-Artikel",
        "Medium_": "Text-Bild",
        "Bodytext_": "*pn*Gr�ne Z�rich*/pn*\n\n*pd*18.03.19*/pd*\n\n*pb*�Vor ihm haben unsere Eltern uns immer gewarnt�, schreibt der�Tages-Anzeiger��ber unseren Kantonsrat R�bi Brunner!�Rafa Ella Roth�vom startet ihren neuen Tagi-Videotalk �Hobbyruum�.�#Klimawahl2019*/pb*\n\n*ab*Tagesanzeiger*/ab*\n\n*ad*15.03.19*/ad*\n\n*an*someName*/an*\n\n*aa*Rafaela Roth*/aa*\n\n*at*Vor ihm haben unsere Eltern uns immer gewarnt*/at*\n\n*al*Rafaela Roth trifft auf den Charmebolzen der Gr�nen: Robert �R�bi� Brunner. Start des Tagi-Videotalks �Hobbyruum�.*/al*\n\n*ab*Am 24. M�rz w�hlt der Kanton Z�rich eine neue Regierung. Bis dahin schnappt sich die Z�ri-Redaktorin Rafaela Roth ein paar potenzielle Kandidierende f�r eine kleine Bastel-Challenge. Dies ist der neue �Hobbyruum�, ein Videotalk, in welchem wir nicht nur �ber Politik sprechen, aber auch. Sehen Sie jetzt Folge 1 - heute mit dem Kantonsrat der Gr�nen: Robert �R�bi� Brunner.*/ab**ab*jlaksdjföl kajsdöfoija weöoifjaoöwiejföaijseflöi ajsdflö*/ab*",
        "LinkText_": "https://www.tagesanzeiger.ch/zuerich/region/vor-ihm-haben-unsere-eltern-uns-immer-gewarnt/story/29250246?fbclid=%20a-W0xm7rwdCcTAy96QSjQgLH5-QDSB0",
        "LinkBild_": "DS_A_26-03-19",
        "Bildunterschriften_": "Robert Brunners Lieblingsdroge?: �Rotwein! Drogen machen eine weiche Birne.�.Video: Lea Blum, Sarah Fluck"
    },
    {
        "Profil_": "DD",
        "Position_": "2",
        "Datum_": "3/18/2019",
        "Uhrzeit_": "16:04",
        "Thema_": "Demonstration",
        "Gesinnung_": "Rechts",
        "Verl�sslichkeit_": "Reisserisch",
        "Art_": "Privat Person",
        "Aufbau_": "Re-Post-Artikel",
        "Medium_": "Text-Bild",
        "Bodytext_": "*pn*Erich Hess*/pn*\n\n*pd*18.03.2019*/pd*\n\n*pb*Das ist typisch f�r den rot - gr�nen Filz in der Stadt Bern!*/pb*\n\n*rn*TeleB�rn*/rn*\n\n*aa*TeleB�rn*/aa*\n\n*rd*18.03.2019*/rd*\n\n*rt*Klima-Aktivisten d�rfen trotz Kundgebungs-Verbot demonstrieren:*/rt*\n\n*an*TeleB�rn News*/an*\n\n*ad*17.03.2019*/ad*\n\n*at*�Eine absolute Sauerei!� Erich Hess �rgert sich �ber Kundgebungs-Erlaubnis der Klima-Aktivisten*/at*\n\n*ab* Grunds�tzlich gilt zwei Wochen vor den eidgen�ssischen Wahlen ein Kundgebungs-Verbot. Klimaschutz-Aktivisten planen jedoch kurz vorher erneut eine Demo � und das sogar mit Erlaubnis. */ab**al*Some Lead Some Lead Some Lead Some Lead Some Lea*/al*",
        "LinkText_": "https://www.telebaern.tv/telebaern-news/eine-absolute-sauerei-erich-hess-aergert-sich-ueber-kundgebungs-erlaubnis-der-klima-aktivisten-134221166?utm_source=shared-twitter&fbclid=IwAR2DMQycuNK_OiDkvaLpp2KcAg2gwONaauP0IR5cthGdnTE8k8lSELatxvU",
        "LinkBild_": "Bildschirmfoto 2019-03-18 um 15.05.09",
        "Bildunterschriften_": ""
    }
]

// var numberOfIterations = data.length;
var numberOfIterations = 2;


var lastPage = 0;
var doc = app.documents.item(0);
var page = doc.pages.item(lastPage);
var borderLeft = leftPage ? 8 : 18;
var borderRight = leftPage ? 18 : 8;
var borderTopBottom = 18;
// var pageWidth = page.bounds[3] -  page.bounds[1];
// var pageHeight = page.bounds[2] -  page.bounds[0];
var pageWidth = page.bounds[3] -  page.bounds[1] - borderLeft - borderRight;
var pageHeight = page.bounds[2] -  page.bounds[0] - 2 * borderTopBottom;
var allGroups = [];
var wholeLength = 0;
// var numberOfIterations = data.length;
var imagePath = './img/'
var gutter = 2;
var column = (pageWidth - (17 * gutter)) / 18;
var colGutter = column + gutter;
var headerHeight = 3;

for (var i = 0; i < numberOfIterations; i++) {
    var leftPage = lastPage % 2 == 0;

    var newGroup = addGroup(i);
    allGroups.push(newGroup);

    wholeLength += getElement(newGroup).height;


    // if (allGroups[i-1]) {

    //     var groupMarginTop = 4;

    //     // positionElement(newGroup, borderLeft, getElement(allGroups[i-1]).y2 + groupMarginTop + borderTopBottom, 0, 0);

    //     if(wholeLength >= pageHeight * (lastPage + 1) + groupMarginTop - 2 * borderTopBottom) {
    //         doc.pages.add();
    //         lastPage ++;
    //         newGroup.move(doc.pages[lastPage])
    //         positionElement(newGroup, borderLeft, getElement(allGroups[i-1]).y2 + groupMarginTop + borderTopBottom, 0, 0);
    //     }
        
    // }


    doc.pages.add();
    lastPage ++;
    newGroup.move(doc.pages[lastPage])

    // positionElement(newGroup, borderLeft, getElement(allGroups[i-1]).y2 + groupMarginTop + borderTopBottom, 0, 0);
    if (leftPage) {
        positionElement(newGroup, - borderLeft / 2, borderTopBottom, 0, 0);
    } else {
        positionElement(newGroup, borderLeft + borderRight + pageWidth , borderTopBottom, 0, 0);
    }
}



function addGroup(index) {

    var itemsToGroup = new Array();  
    var id = '#' + index;

    // ===============
    // Profil
    // ===============

    var tb_profil = createTextbox('tb_profil', id, '\nPROFIL ' + data[index].Profil_, itemsToGroup, 14);
    // tb_profil.paragraphs[0].pointSize = 18;
    tb_profil.paragraphs[0].justification = Justification.CENTER_ALIGN;
    tb_profil.strokeColor = app.activeDocument.colors.item("Black");  
    tb_profil.strokeWeight = 0.75; 
    tb_profil.paragraphs[0].leading = headerHeight * 3;
    positionElement(tb_profil, 0, 18, 0, 0);
    setDimensions(tb_profil, pageWidth/3 - 3, headerHeight, 0, 0);

    tb_profil.select(SelectionOptions.ADD_TO);

    // ===============
    // Position
    // ===============

    var tb_position = createTextbox('tb_position', id, '\nPOST  ' + data[index].Position_, itemsToGroup, 14);
    // tb_position.paragraphs[0].pointSize = 18;
    tb_position.paragraphs[0].justification = Justification.CENTER_ALIGN;
    tb_position.strokeColor = app.activeDocument.colors.item("Black");  
    tb_position.strokeWeight = 0.75; 
    tb_position.paragraphs[0].leading = headerHeight * 3;
    positionElement(tb_position, pageWidth / 3 + 3, 18, 0, 0);
    setDimensions(tb_position, pageWidth/3 - 3, headerHeight, 0, 0);

    tb_position.select(SelectionOptions.ADD_TO);

    // ===============
    // Uhrzeit
    // ===============

    var tb_uhrzeit = createTextbox('tb_uhrzeit', id, '\n' + data[index].Uhrzeit_, itemsToGroup, 14);
    tb_uhrzeit.paragraphs[0].justification = Justification.CENTER_ALIGN;
    tb_uhrzeit.strokeColor = app.activeDocument.colors.item("Black");  
    tb_uhrzeit.strokeWeight = 0.75; 
    tb_uhrzeit.paragraphs[0].leading = headerHeight * 3;
    positionElement(tb_uhrzeit, pageWidth/3 * 2 + 6, 18, 0, 0);
    setDimensions(tb_uhrzeit, pageWidth/3 - 3, headerHeight, 0, 0);

    tb_uhrzeit.select(SelectionOptions.ADD_TO);

    // ===============
    // Art
    // ===============

    var tb_art = createTextbox('tb_art', id, 'ART\n' + data[index].Art_.toUpperCase(), itemsToGroup, 8);
    positionElement(tb_art, pageWidth/6 * 0, getElement(tb_profil).y2 + 2);
    setDimensions(tb_art, pageWidth/6, null, 0, 0);

    // ===============
    // Aufbau
    // ===============

    var tb_aufbau = createTextbox('tb_aufbau', id, 'AUFBAU\n' + data[index].Aufbau_.toUpperCase(), itemsToGroup, 8);
    positionElement(tb_aufbau, pageWidth/6 * 1, getElement(tb_profil).y2 + 2);
    setDimensions(tb_aufbau, pageWidth/6, null, 0, 0);

    // ===============
    // Medium
    // ===============

    var tb_medium = createTextbox('tb_medium', id, 'MEDIUM\n' + data[index].Medium_.toUpperCase(), itemsToGroup, 8);
    positionElement(tb_medium, pageWidth/6 * 2, getElement(tb_profil).y2 + 2);
    setDimensions(tb_medium, pageWidth/6, null, 0, 0);

    // ===============
    // Gesinnung X
    // ===============

    var tb_gesinnungX = createTextbox('tb_gesinnungX', id, 'GESINNUNG X\n' + data[index].Medium_.toUpperCase(), itemsToGroup, 8);
    positionElement(tb_gesinnungX, pageWidth/6 * 3, getElement(tb_profil).y2 + 2);
    setDimensions(tb_gesinnungX, pageWidth/6, null, 0, 0);

    // ===============
    // Gesinnung Y
    // ===============

    var tb_gesinnungY = createTextbox('tb_gesinnungY', id, 'GESINNUNG Y\n' + data[index].Medium_.toUpperCase(), itemsToGroup, 8);
    positionElement(tb_gesinnungY, pageWidth/6 * 4, getElement(tb_profil).y2 + 2);
    setDimensions(tb_gesinnungY, pageWidth/6, null, 0, 0);

    // ===============
    // Verlässlichkeit
    // ===============

    var tb_verlasslichkeit = createTextbox('tb_verlasslichkeit', id, 'VERLÄSSLICHKEIT\n' + data[index].Medium_.toUpperCase(), itemsToGroup, 8);
    positionElement(tb_verlasslichkeit, pageWidth/6 * 5, getElement(tb_profil).y2 + 2);
    setDimensions(tb_verlasslichkeit, pageWidth/6, null, 0, 0);


    addLine(0, getElement(tb_verlasslichkeit).y2 + 2 , pageWidth, itemsToGroup);

    // ===============
    // Body Text
    // ===============

    var fullText = data[index].Bodytext_;
    // alert(fullText);
    var postName = getText(fullText, 'pn');
    var postDatum = getText(fullText, 'pd');
    var postBodyText = getText(fullText, 'pb');
    var repostName = getText(fullText, 'rn');
    var repostDatum = getText(fullText, 'rd');
    var repostBodyText = getText(fullText, 'rb');
    var artikelName = getText(fullText, 'an');
    var artikelDatum = getText(fullText, 'ad');
    var artikelAuthor = getText(fullText, 'aa');
    var artikelTitel = getText(fullText, 'at');
    var artikelLead = getText(fullText, 'al');
    var artikelUntertitel = getText(fullText, 'au');
    // var artikelBodyTexts = getMultipleTexts(fullText, 'ab');
    var artikelBodyTexts = getText(fullText, 'ab');

    // Post Typ

    var tb_text_postTyp = createTextbox('tb_text_postTyp', id, 'POST', itemsToGroup, 14);
    positionElement(tb_text_postTyp, pageWidth/3 * 0, getElement(tb_art).y2 + 5);
    setDimensions(tb_text_postTyp, pageWidth/ 3, null, 0, 0);

    // Post Name

    var tb_text_postName = createTextbox('tb_text_postName', id, postName.toUpperCase(), itemsToGroup, 14);
    tb_text_postName.paragraphs[0].justification = Justification.CENTER_ALIGN;
    positionElement(tb_text_postName, pageWidth/3 * 1, getElement(tb_art).y2 + 5);
    setDimensions(tb_text_postName, pageWidth/3, null, 0, 0);

    // Post Datum

    var tb_text_postDatum = createTextbox('tb_text_postDatum', id, postDatum, itemsToGroup, 14);
    tb_text_postDatum.paragraphs[0].justification = Justification.RIGHT_ALIGN;
    positionElement(tb_text_postDatum, pageWidth/3 * 2, getElement(tb_art).y2 + 5);
    setDimensions(tb_text_postDatum, pageWidth/3, null, 0, 0);

    // Post Body Text

    var tb_text_postBodyText = createTextbox('tb_text_postBodyText', id, postBodyText, itemsToGroup, 20);
    tb_text_postBodyText.paragraphs[0].appliedFont = app.fonts.item("Neue Haas Unica Pro");
    tb_text_postBodyText.paragraphs[0].fontStyle = "Black";
    tb_text_postBodyText.paragraphs[0].leading = "20pt";
    // tb_text_postBodyText.paragraphs[0].kerning = "-5";
    // tb_text_postBodyText.paragraphs[0].tracking = "-10";
    positionElement(tb_text_postBodyText, 0, getElement(tb_text_postTyp).y2 + 4);
    setDimensions(tb_text_postBodyText, pageWidth, null, 0, 2);

    addLine(0, getElement(tb_text_postBodyText).y2 + 2 , pageWidth, itemsToGroup);


    if (artikelName) {

        var tb_text_artikelTyp = createTextbox('tb_text_artikelTyp', id, 'ARTIKEL', itemsToGroup, 14);
        positionElement(tb_text_artikelTyp, colGutter * 2, getElement(tb_text_postBodyText).y2 + 7);
        setDimensions(tb_text_artikelTyp, colGutter * 3, null, 0, 0);


        if (artikelName) {
                // Artikel Name

            var tb_text_artikelName = createTextbox('tb_text_artikelName', id, artikelName.toUpperCase(), itemsToGroup, 14);
            tb_text_artikelName.paragraphs[0].justification = Justification.CENTER_ALIGN;
            positionElement(tb_text_artikelName, colGutter * 5, getElement(tb_text_postBodyText).y2 + 7);
            setDimensions(tb_text_artikelName, colGutter * 8, null, 0, 0);

        }
        
        if (artikelDatum) {

            // Artikel Datum

            var tb_text_artikelDatum = createTextbox('tb_text_artikelDatum', id, artikelDatum, itemsToGroup, 14);
            tb_text_artikelDatum.paragraphs[0].justification = Justification.RIGHT_ALIGN;
            positionElement(tb_text_artikelDatum, colGutter * 13, getElement(tb_text_postBodyText).y2 + 7);
            setDimensions(tb_text_artikelDatum, colGutter * 3 - gutter, null, 0, 0);
        }
        
        if (artikelTitel) {

            // Artikel Body Text

            var tb_text_artikelTitel = createTextbox('tb_text_artikelTitel', id, artikelTitel, itemsToGroup, 20);
            tb_text_artikelTitel.paragraphs[0].appliedFont = app.fonts.item("Neue Haas Unica Pro");
            tb_text_artikelTitel.paragraphs[0].fontStyle = "Black";
            tb_text_artikelTitel.paragraphs[0].leading = "20pt";
            // tb_text_artikelTitel.paragraphs[0].kerning = "-5";
            // tb_text_artikelTitel.paragraphs[0].tracking = "-10";
            positionElement(tb_text_artikelTitel, colGutter * 2, getElement(tb_text_artikelTyp).y2 + 4);
            setDimensions(tb_text_artikelTitel, colGutter * 14 - gutter, null, 0, 0);

            addLine(colGutter * 2, getElement(tb_text_artikelTitel).y2 + 2 , colGutter * 14, itemsToGroup);
        }

        if (artikelAuthor) {

            // Artikel Author

            var tb_text_artikelAuthor = createTextbox('tb_text_artikelAuthor', id, artikelAuthor.toUpperCase(), itemsToGroup, 14);
            tb_text_artikelAuthor.paragraphs[0].justification = Justification.RIGHT_ALIGN;
            positionElement(tb_text_artikelAuthor, colGutter * 2, getElement(tb_text_artikelTitel).y2 + 4);
            setDimensions(tb_text_artikelAuthor, colGutter * 14 - gutter, null, 0, 0);
        }

        if (artikelLead) {

            // Artikel Lead

            var tb_text_artikelLead = createTextbox('tb_text_artikelLead', id, artikelLead.toUpperCase(), itemsToGroup, 8);
            tb_text_artikelLead.paragraphs[0].leading = "9pt";
            tb_text_artikelLead.paragraphs[0].justification = Justification.CENTER_ALIGN;
            positionElement(tb_text_artikelLead, colGutter * 4, getElement(tb_text_artikelAuthor).y2 + 7);
            setDimensions(tb_text_artikelLead, colGutter * 10 - gutter, null, 0, 0);
        }

        if (artikelBodyTexts) {

            // Artikel BodyText

            for (var i = 0; i < artikelBodyTexts; i ++) {

                var tb_text_artikelBodyText = createTextbox('tb_text_artikelBodyText', id, artikelBodyTexts[i], itemsToGroup, 8);
                tb_text_artikelBodyText.paragraphs[0].leading = "9pt";
                tb_text_artikelBodyText.paragraphs[0].justification = Justification.CENTER_ALIGN;
                positionElement(tb_text_artikelBodyText, colGutter * 4, getElement(tb_text_artikelLead).y2 + 7);
                setDimensions(tb_text_artikelBodyText, colGutter * 10 - gutter, null, 0, 0);
            }
        }
    }

    // var tb_text_artikelDatum = createTextbox('tb_text_artikelDatum', id, artikelDatum, itemsToGroup, 12);
    // positionElement(tb_text_artikelDatum, pageWidth/6, getElement(tb_text_postBodyText).y2);
    // setDimensions(tb_text_artikelDatum, pageWidth/6, null, 0, 0);

    // var tb_text_artikelBodytext = createTextbox('tb_text_artikelBodytext', id, artikelBodytext, itemsToGroup, 12);
    // positionElement(tb_text_artikelBodytext, pageWidth/6 * 2, getElement(tb_text_postBodyText).y2);
    // setDimensions(tb_text_artikelBodytext, pageWidth/6*3, null, 0, 0);


    // var tb_linkBild = page.textFrames.add();
    // tb_linkBild.contents = data[index].LinkBild_;

    // var tb_bildUnterschriften = page.textFrames.add();
    // tb_bildUnterschriften.contents = data[index].Bildunterschriften_;


    var myGroup = app.documents[0].groups.add(itemsToGroup);  
    myGroup.name = 'element_' + id;
    

    return myGroup;
}

function addImage(index) {
        
    // ===============
    // Image
    // ===============

    var image = doc.pages.item(lastPage).textFrames.add();
    // image.contents = data[index].LinkBild_ || 'unknown';
    // image.name = 'element_' + id + '_textbox_' * element;
    

    image.place (File(app.activeDocument.filePath + '/img/' + data[index].LinkBild_ + '.jpg'), false);
    // image.recompose();
    image.fit(FitOptions.frameToContent);
    // image.fit (FitOptions.CONTENT_TO_FRAME);
    // image.fit (FitOptions.PROPORTIONALLY);
    // image.fit (FitOptions.CENTER_CONTENT);
    // image.recompose();
    // image.fit(FitOptions.frameToContent);

    positionElement(image, 2, 2, 0, 0);
    setDimensions(image, null, 10, 0, 0);

    var text = doc.pages.item(lastPage).textFrames.add();
    text.contents = data[index].Bildunterschriften_ || 'unknown';
    text.recompose();
    text.fit(FitOptions.frameToContent);
    positionElement(image, 2, getElement(image).y2);
}

function createTextbox(element, id, content, array, fontSize) {

    var item = doc.pages.item(lastPage).textFrames.add();
    item.contents = content || 'unknown';
    item.recompose();
    item.fit(FitOptions.frameToContent);
    item.name = 'element_' + id + '_textbox_' * element;
    item.paragraphs[0].pointSize = fontSize;
    array.push(item);

    var text = item.paragraphs[0];
    text.appliedFont = app.fonts.item("Nimbus Roman Mono M");
    text.fontStyle = "Regular";

    return item;
}


function positionElement(element, x, y) {
    // element.recompose();
    element.fit(FitOptions.frameToContent);

    x = x + borderLeft;
    
    var elementWidth = element.geometricBounds[3] -  element.geometricBounds[1];
    var elementHeight = element.geometricBounds[2] -  element.geometricBounds[0];

    element.geometricBounds = [y, x, y + elementHeight, x + elementWidth];

}

function getElement(element) {

    var item = {
        x: element.geometricBounds[1],
        y: element.geometricBounds[0],
        x2: element.geometricBounds[3],
        y2: element.geometricBounds[2],
        width: element.geometricBounds[3] -  element.geometricBounds[1],
        height: nameHeight = element.geometricBounds[2] -  element.geometricBounds[0],
    }

    return item;
}

function setDimensions(element, width, height, spacingRight, spacingBottom) {

    var dimensions = element.geometricBounds;

    if (width) {
        element.geometricBounds = [dimensions[0], dimensions[1], dimensions[2], dimensions[1] + width];
    }

    dimensions = element.geometricBounds;

    if (spacingRight) {
        element.geometricBounds = [dimensions[0], dimensions[1], dimensions[2], dimensions[1] + spacingRight];
    }

    element.fit(FitOptions.frameToContent);
    dimensions = element.geometricBounds;

    if (height) {
        element.geometricBounds = [dimensions[0], dimensions[1], dimensions[2] + height, dimensions[3] ];
    }

    dimensions = element.geometricBounds;


    if (spacingBottom) {
        element.geometricBounds = [dimensions[0], dimensions[1], dimensions[2] + spacingBottom, dimensions[3] ];
    }

}

function getText(fullText, type) {

    // var partial = fullText.split('*' + type + '*').pop().split("\n")[0] || 'unknown';
    var partial = fullText.split('*' + type + '*').pop().split('*/' + type + '*')[0] || 'unknown';
    return partial;
}

function getMultipleTexts(fullText, type) {

    // var partial = fullText.split('*' + type + '*').pop().split("\n")[0] || 'unknown';
    var partials = fullText.split('*' + type + '*').pop().split('*/' + type + '*');

    return partials;
}


function addLine(x, y, length, array) {

    x = x + borderLeft;
       
    var myLine = doc.pages.item(lastPage).graphicLines.add();  
    
    myLine.strokeColor = app.activeDocument.colors.item("Black");  
    myLine.strokeWeight = 0.75; 
    
  
    plotStraightLine(myLine, x, y, x + length, y); 

    array.push(myLine);

}

  
  
function plotStraightLine(obj, x1, y1, x2, y2) {  
    obj.paths.item(0).pathPoints.item(0).anchor = [x1, y1];  
    obj.paths.item(0).pathPoints.item(1).anchor = [x2, y2];  
}  